<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 from xdocs/tutorial/step3.xml at 19 Jan 2022
 | Rendered using Apache Maven Fluido Skin 1.9
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.2" />
    <meta name="author" content="Siegfried Goeschl" />
    <title>Fulcrum YAAFI Avalon Container &#x2013; Fulcrum YAAFI Avalon Container Tutorial Step 3</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.9.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.9.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <a href="https://github.com/apache/turbine-core">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"
        alt="Fork me on GitHub">
    </a>
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="https://turbine.apache.org/" id="bannerLeft" title="Apache Turbine"><img src="https://turbine.apache.org/images/turbine-project.png"  alt="Apache Turbine"/></a></div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 19 Jan 2022<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.0.9-SNAPSHOT</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://turbine.apache.org/fulcrum/" class="externalLink" title="Fulcrum">Fulcrum</a></li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://turbine.apache.org/" class="externalLink" title="Turbine">Turbine</a></li>
      <li class="pull-right"><a href="https://www.apache.org" class="externalLink" title="Apache">Apache</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="../index.html" title="Main"><span class="none"></span>Main</a></li>
    <li><a href="../downloads.html" title="Downloads"><span class="none"></span>Downloads</a></li>
    <li><a href="../howto.html" title="How To"><span class="none"></span>How To</a></li>
    <li><a href="../cryptography.html" title="Cryptography"><span class="none"></span>Cryptography</a></li>
    <li><a href="../lifecycle/index.html" title="Lifecycle"><span class="icon-chevron-right"></span>Lifecycle</a></li>
    <li><a href="../interceptors/index.html" title="Interceptors"><span class="icon-chevron-right"></span>Interceptors</a></li>
    <li><a href="../services/index.html" title="Services"><span class="icon-chevron-right"></span>Services</a></li>
    <li><a href="../specification/index.html" title="Specification"><span class="icon-chevron-right"></span>Specification</a></li>
    <li><a href="../tutorial/index.html" title="Tutorial"><span class="icon-chevron-down"></span>Tutorial</a>
     <ul class="nav nav-list">
      <li><a href="../tutorial/step1.html" title="Step 1"><span class="none"></span>Step 1</a></li>
      <li><a href="../tutorial/step2.html" title="Step 2"><span class="none"></span>Step 2</a></li>
      <li class="active"><a href="#"><span class="none"></span>Step 3</a></li>
      <li><a href="../tutorial/step4.html" title="Step 4"><span class="none"></span>Step 4</a></li>
      <li><a href="../tutorial/step5.html" title="Step 5"><span class="none"></span>Step 5</a></li>
     </ul></li>
    <li><a href="../design.html" title="Design Considerations"><span class="none"></span>Design Considerations</a></li>
    <li><a href="../todo.html" title="Todo's"><span class="none"></span>Todo's</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
   <li class="nav-header">Apache</li>
    <li><a href="https://www.apache.org/" class="externalLink" title="Apache Website"><span class="none"></span>Apache Website</a></li>
    <li><a href="https://www.apache.org/licenses/" class="externalLink" title="License"><span class="none"></span>License</a></li>
    <li><a href="https://www.apache.org/foundation/how-it-works.html" class="externalLink" title="How the ASF works"><span class="none"></span>How the ASF works</a></li>
    <li><a href="https://www.apache.org/foundation/sponsorship.html" class="externalLink" title="Sponsorship"><span class="none"></span>Sponsorship</a></li>
    <li><a href="https://www.apache.org/foundation/thanks.html" class="externalLink" title="Thanks"><span class="none"></span>Thanks</a></li>
    <li><a href="https://www.apache.org/security/" class="externalLink" title="Security"><span class="none"></span>Security</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
<form id="search-form" action="https://www.google.com/search" method="get" >
  <input value="http://turbine.apache.org/fulcrum/fulcrum-yaafi" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script>asyncJs( 'https://cse.google.com/brand?form=search-form' )</script>
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >


  

    <section>
<h2><a name="Implementing_an_Avalon_Service"></a>Implementing an Avalon Service</h2>

      <section>
<h3><a name="Defining_an_Interface_and_an_Implementation_Class"></a>Defining an Interface and an Implementation Class</h3>
        
<p>
          The evry first step is to define an interface and a corresponding implementation
          class.
          </p>
<ul>
            
<li>org.apache.fulcrum.yaafi.service.systemproperty.SystemPropertyService as interface</li>
            
<li>org.apache.fulcrum.yaafi.service.systemproperty.SystemPropertyServiceImpl as implementation class</li>
          </ul>
        
      </section>

      <section>
<h3><a name="Writing_the_interface"></a>Writing the interface</h3>
        
<p>
          The interface exposes only business methods and never ever one of the various Avalon
          interfaces.
          </p>
<div class="source"><pre class="prettyprint">
public interface SystemPropertyService
{
    // This interface doesn't exposes any other methods
}
          </pre></div>
        
      </section>

      <section>
<h3><a name="Chasing_the_Interfaces_to_Implement"></a>Chasing the Interfaces to Implement</h3>
        
<p>
          The Avalon Service Container interacts with an Avalon service
          through a bunch of interfaces also known as
          <a href="../lifecycle/index.html">Avalon Lifecycle
          Management Specification</a>. Finding the right interface might be
          challenge in the beginning but it is not an unsurmountable task.
          Our service needs access to the logging infrastructure, to the
          component configuration and needs to tell the Avalon Service
          Container that it is reconfigurable. To make things more
          interesting we want to dump the updated system properties into
          the temp directory of the application during service initialization.
          </p>
<div class="source"><pre class="prettyprint">
public class SystemPropertyServiceImpl
    extends AbstractLogEnabled
    implements SystemPropertyService, Reconfigurable, Contextualizable, Initializable
{
    // here comes the implementation ...
}
          </pre></div>
        
        
<p>
          Our service derives from &quot;AbstractLogEnabled&quot; which takes
          care of getting access to the logger. The implementation
          class also implements the &quot;Reconfigurable&quot; interface which
          tells the Avalon Service Container that the service implements
          </p>
<ul>
            
<li>public void configure(Configuration configuration)</li>
            
<li>public void reconfigure(Configuration configuration)</li>
          </ul>
        
        
<p>
          The information about the application context is provided by
          the &quot;Contextualizable&quot; interface while the service initialization
          needs the &quot;Initializable&quot; interface.
        </p>
      </section>

      <section>
<h3><a name="Accessing_the_Avalon_Context"></a>Accessing the Avalon Context</h3>
        
<p>
          The <a href="../specification/context.html">Avalon Context </a>contains
          environment settings such as the current working directory, the
          temporary directory or the name of the service.
            </p>
<div class="source"><pre class="prettyprint">
public void contextualize(Context context) throws ContextException
{
    this.tempDir = (File) context.get(&quot;urn:avalon:temp&quot;);
}
            </pre></div>
        
      </section>

      <section>
<h3><a name="Accessing_the_Component_Configuration"></a>Accessing the Component Configuration</h3>
        
<p>
          In the Role Configuration file we defined &quot;SystemPropertyService&quot; as shorthand for accessing
          the Component Configuration. The Component Configuration we use is shown below
            </p>
<div class="source"><pre class="prettyprint">
&lt;SystemPropertyService&gt;
    &lt;property name=&quot;FOO&quot;&gt;BAR&lt;/property&gt;
&lt;/SystemPropertyService&gt;
            </pre></div>
        
        
<p>
          Let's access the configuration to set the system properties - we get all childrem from
          the configuration instance and process them. Each child consists of an attribute
          containing the name and text for the value of the system property to be set. We also
          write some diagnostic ouptut by requesting the logger instance from &quot;AbstractLogEnabled&quot;.
            </p>
<div class="source"><pre class="prettyprint">
public void configure(Configuration configuration) throws ConfigurationException
{
    Configuration[] systemProperties = configuration.getChildren(&quot;property&quot;);

    for( int i=0; i&lt;systemProperties.length; i++ )
    {
        String key = systemProperties[i].getAttribute(&quot;name&quot;);
        String value = systemProperties[i].getValue();
        this.getLogger().debug( &quot;Setting the value of &quot; + key + &quot; to &quot; + value );
        System.setProperty( key, value );
    }
}
            </pre></div>
        
      </section>

      <section>
<h3><a name="Service_Initialization"></a>Service Initialization </h3>
        
<p>
          Since we have done most of our work already we use the
          service initialization to dump the current system properties
          into the temporary directory.
            </p>
<div class="source"><pre class="prettyprint">
public void initialize() throws Exception
{
    FileOutputStream fos = new FileOutputStream( new File(this.tempDir,&quot;system.properties&quot;) );
    System.getProperties().store( fos, &quot;system.properties&quot; );
    fos.flush();
    fos.close();
}
            </pre></div>
        
      </section>

      <section>
<h3><a name="Implementing_the_Reconfiguration"></a>Implementing the Reconfiguration</h3>
        
<p>
          Making our service reconfigurable is simple. When the service is
          reconfigured a new configuration instance is passed. We just reuse
          the configure() method to reinitalize our service - that's it.
          </p>
<div class="source"><pre class="prettyprint">
public void reconfigure(Configuration configuration) throws ConfigurationException
{
    this.configure(configuration);
}
          </pre></div>
        
      </section>

      <section>
<h3><a name="Putting_it_all_together"></a>Putting it all together</h3>
        
<p>
          Below you find your first complete and fully functional Avalon service.
          </p>
<div class="source"><pre class="prettyprint">
public interface SystemPropertyService
{
    // This interface doesn't exposes any other methods
}

public class SystemPropertyServiceImpl
    extends AbstractLogEnabled
    implements SystemPropertyService, Reconfigurable, Contextualizable, Initializable
{
    /** the Avalon temp directory */
    private File tempDir;

    /**
     * @see org.apache.avalon.framework.context.Contextualizable#contextualize(org.apache.avalon.framework.context.Context)
     */
    public void contextualize(Context context) throws ContextException
    {
        this.tempDir = (File) context.get(&quot;urn:avalon:temp&quot;);
    }

    /**
     * @see org.apache.avalon.framework.configuration.Configurable#configure(org.apache.avalon.framework.configuration.Configuration)
     */
    public void configure(Configuration configuration) throws ConfigurationException
    {
        Configuration[] systemProperties = configuration.getChildren(&quot;property&quot;);

        for( int i=0; i&lt;systemProperties.length; i++ )
        {
            String key = systemProperties[i].getAttribute(&quot;name&quot;);
            String value = systemProperties[i].getValue();
            this.getLogger().debug( &quot;Setting the value of &quot; + key + &quot; to &quot; + value );
            System.setProperty( key, value );
        }
    }

    /**
     * @see org.apache.avalon.framework.activity.Initializable#initialize()
     */
    public void initialize() throws Exception
    {
        FileOutputStream fos = new FileOutputStream( new File(this.tempDir,&quot;system.properties&quot;) );
        System.getProperties().store( fos, &quot;system.properties&quot; );
        fos.flush();
        fos.close();
    }

    /**
     * @see org.apache.avalon.framework.configuration.Reconfigurable#reconfigure(org.apache.avalon.framework.configuration.Configuration)
     */
    public void reconfigure(Configuration configuration)
        throws ConfigurationException
    {
        this.configure(configuration);
    }
}
          </pre></div>
        
      </section>

    </section>

  


        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>&#169;      2004&#x2013;2022
<a href="https://www.apache.org/">The Apache Software Foundation</a>
</p>
        </div>
      </div>
    </footer>
  </body>
</html>
