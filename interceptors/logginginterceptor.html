<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 from xdocs/interceptors\logginginterceptor.xml at 14 Sep 2021

 | Rendered using Apache Maven Default Skin
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.2" />
    <meta name="author" content="Siegfried Goeschl" />
    <title>Fulcrum YAAFI Avalon Container &#x2013; Fulcrum YAAFI Avalon Container Interceptors</title>
    <link rel="stylesheet" href="../css/maven-base.css" />
    <link rel="stylesheet" href="../css/maven-theme.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
  </head>
  <body class="composite">
    <div id="banner">
<a href="https://turbine.apache.org/" id="bannerLeft" title="Apache Turbine"><img src="https://turbine.apache.org/images/turbine-project.png"  alt="Apache Turbine"/></a>      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">
        <span id="publishDate">Last Published: 14 Sep 2021</span>
          &#xA0;| <span id="projectVersion">Version: 1.0.9-SNAPSHOT</span>
      </div>
      <div class="xright"><a href="https://www.apache.org" class="externalLink" title="Apache">Apache</a> |
<a href="https://turbine.apache.org/" class="externalLink" title="Turbine">Turbine</a> |
<a href="https://turbine.apache.org/fulcrum/" class="externalLink" title="Fulcrum">Fulcrum</a>      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
       <h5>Overview</h5>
    <ul>
     <li class="none"><a href="../index.html" title="Main">Main</a></li>
     <li class="none"><a href="../downloads.html" title="Downloads">Downloads</a></li>
     <li class="none"><a href="../howto.html" title="How To">How To</a></li>
     <li class="none"><a href="../cryptography.html" title="Cryptography">Cryptography</a></li>
     <li class="collapsed"><a href="../lifecycle/index.html" title="Lifecycle">Lifecycle</a></li>
     <li class="expanded"><a href="../interceptors/index.html" title="Interceptors">Interceptors</a>
      <ul>
       <li class="none"><strong>Logging</strong></li>
       <li class="none"><a href="../interceptors/performanceinterceptor.html" title="Performance">Performance</a></li>
       <li class="none"><a href="../interceptors/jamoninterceptor.html" title="JAMon">JAMon</a></li>
      </ul></li>
     <li class="collapsed"><a href="../services/index.html" title="Services">Services</a></li>
     <li class="collapsed"><a href="../specification/index.html" title="Specification">Specification</a></li>
     <li class="collapsed"><a href="../tutorial/index.html" title="Tutorial">Tutorial</a></li>
     <li class="none"><a href="../design.html" title="Design Considerations">Design Considerations</a></li>
     <li class="none"><a href="../todo.html" title="Todo's">Todo's</a></li>
    </ul>
       <h5>Project Documentation</h5>
    <ul>
     <li class="collapsed"><a href="../project-info.html" title="Project Information">Project Information</a></li>
     <li class="collapsed"><a href="../project-reports.html" title="Project Reports">Project Reports</a></li>
    </ul>
       <h5>Apache</h5>
    <ul>
     <li class="none"><a href="https://www.apache.org/" class="externalLink" title="Apache Website">Apache Website</a></li>
     <li class="none"><a href="https://www.apache.org/licenses/" class="externalLink" title="License">License</a></li>
     <li class="none"><a href="https://www.apache.org/foundation/how-it-works.html" class="externalLink" title="How the ASF works">How the ASF works</a></li>
     <li class="none"><a href="https://www.apache.org/foundation/sponsorship.html" class="externalLink" title="Sponsorship">Sponsorship</a></li>
     <li class="none"><a href="https://www.apache.org/foundation/thanks.html" class="externalLink" title="Thanks">Thanks</a></li>
     <li class="none"><a href="https://www.apache.org/security/" class="externalLink" title="Security">Security</a></li>
    </ul>
      <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
      </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">


  

    <section>
<h2><a name="Overview"></a>Overview</h2>
      
<p>
        The service solves a simple problem - when a customer complains that
        something is broken quite often the logfile is not enough - a glimpse at the
        parameters being used for the service invocation would help a great deal.
        Therefore this interceptor is intended for running in the background and
        dumping all parameters when an exception occurs.
      </p>
    </section>

    <section>
<h2><a name="Filtering_using_the_Logger"></a>Filtering using the Logger</h2>
      
<p>
        The service implementation uses the trace level of its logger to control
        the generated output. E.g. setting the tracelevel to INFO would result in
        tracing method invocations and exceptions but would ignore the results from
        the mehtod invocation.
        </p>
<table border="0" class="bodyTable">
          
<tr class="a">
            
<th>Trace Level</th>
            
<th>Description</th>
          </tr>
          
<tr class="b">
            
<td>ERROR</td>
            
<td>Dumps the context information for an onError invocation</td>
          </tr>
          
<tr class="a">
            
<td>INFO</td>
            
<td>Dumps the context information for an onEntry invocation</td>
          </tr>
          
<tr class="b">
            
<td>DEBUG</td>
            
<td>Dumps the context information for an onExit invocation</td>
          </tr>
        </table>
      
    </section>

    <section>
<h2><a name="Captured_Information"></a>Captured Information</h2>
      
<p>
        During the execution the service captures the following information for
        producing a meaning log
        </p>
<table border="0" class="bodyTable">
          
<tr class="a">
            
<th>Item</th>
            
<th>Description</th>
          </tr>
          
<tr class="b">
            
<td>Transaction ID (TID)</td>
            
<td>the number of times the invocationDepth was zero</td>
          </tr>
          
<tr class="a">
            
<td>Invocation ID (IID)</td>
            
<td>the current number of inovking a service method</td>
          </tr>
          
<tr class="b">
            
<td>InvocationDepth (ID)</td>
            
<td>
              the service invocation depth, e.g a value of &quot;1&quot; that
              the currently invoked service method was invoked by
              another service. A value of &quot;0&quot; indicates that the service
              method was directly invoked from the caller therefore
              starting a new transaction
            </td>
          </tr>
          
<tr class="a">
            
<td>Mode (M)</td>
            
<td>
              the invocation mode of the interceptor
              
<ul>
                
<li>0 ==&gt; entering the service method</li>
                
<li>1 ==&gt; leaving the the service method</li>
                
<li>2 ==&gt; an exception occured</li>
              </ul>
            </td>
          </tr>
          
<tr class="b">
            
<td>ServiceName</td>
            
<td>the shorthand of the service being invoked</td>
          </tr>
          
<tr class="a">
            
<td>ServiceMethod</td>
            
<td>the name of the service method being invoked</td>
          </tr>
          
<tr class="b">
            
<td>Millis</td>
            
<td>the execution time in milliseconds</td>
          </tr>
          
<tr class="a">
            
<td>Method Signature</td>
            
<td>the name of the executing thread</td>
          </tr>
          
<tr class="b">
            
<td>Parameters</td>
            
<td>the list of parameter values</td>
          </tr>
          
<tr class="a">
            
<td>Exception</td>
            
<td>the class of the exception being caught</td>
          </tr>
          
<tr class="b">
            
<td>Stacktrace</td>
            
<td>the stacktrace of the exception being caught</td>
          </tr>
        </table>
      
    </section>

    <section>
<h2><a name="Example_Logfile"></a>Example Logfile</h2>
      
<p>
        Looking at the following <a href="tracing.csv">example</a> you see that
        </p>
<ul>
          
<li>that this was the 54th transaction during the lifetime of the container</li>
          
<li>PdfSignatureService.sign wa invoked with the seven parameter values as shown below</li>
          
<li>an invalid PDF document caused a SignatureServiceException</li>
          
<li>SignatureService.sign was the caller of PdfSignatureService.sign and just rethrow the exception.</li>
        </ul>
      
      
<div class="source">
<pre>

TID IID ID M Service             Method Signature

54  402  1 2 PdfSignatureService sign   Object service.signature.SignatureService.sign(
                                        String,String,String,Object,String,String,Hashtable)
                                        arg[0]:={SUPPLIER}
                                        arg[1]:={SUPPLIER}
                                        arg[2]:={de}
                                        arg[3]:={[B@36d047}
                                        arg[4]:={broken.pdf}
                                        arg[5]:={application/pdf}
                                        arg[6]:={{isPdfAttached=false}}
                                        service.signature.SignatureServiceException
                                        Rebuild failed: trailer not found

54  400  0 2 SignatureService    sign   service.signature.SignatureService.sign(
                                        String,String,String,Object,String,String,Hashtable)
                                        arg[0]:={SUPPLIER}
                                        arg[1]:={SUPPLIER}
                                        arg[2]:={de}
                                        arg[3]:={[B@36d047}
                                        arg[4]:={broken.pdf}
                                        arg[5]:={application/pdf}
                                        arg[6]:={{isPdfAttached=false}}
                                        service.signature.SignatureServiceException
                                        Rebuild failed: trailer not found

      </pre></div>
    </section>

    <section>
<h2><a name="Configuration"></a>Configuration</h2>
      <section>
<h3><a name="Component_Configuration"></a>Component Configuration</h3>
        
<table border="0" class="bodyTable">
          
<tr class="a">
            
<th>Item</th>
            
<th>Datatype</th>
            
<th>Cardinality</th>
            
<th>Description</th>
          </tr>
          
<tr class="b">
            
<td>isEnabled</td>
            
<td>Boolean</td>
            
<td>[0|1]</td>
            
<td>
              Turn the interceptor. If no value is supplied then &quot;false&quot; is used
              thereby disabling all interceptor invocations.
            </td>
          </tr>
          
<tr class="a">
            
<td>maxArgLength</td>
            
<td>Integer</td>
            
<td>[0|1]</td>
            
<td>
              The maximum length of an method argument to avoid dumping megabytes
              of data into the logfile.
             </td>
          </tr>
          
<tr class="b">
            
<td>toStringBuilderClass</td>
            
<td>String</td>
            
<td>[0|1]</td>
            
<td>
              The class name of the string builder to use to format the method
              parematers and the result. If no value is supplied the
              SmartToStringBuilder is used.
            </td>
          </tr>
          
<tr class="a">
            
<td>monitorAllExceptions</td>
            
<td>Boolean</td>
            
<td>[0|1]</td>
            
<td>
              Dump all encountered excpetions therefore overriding
              the list of monitored services. If no value is supplied
              then &quot;true&quot; is used.
             </td>
          </tr>
          
<tr class="b">
            
<td>services</td>
            
<td>Tree</td>
            
<td>[0|1]</td>
            
<td>
              Contains a list of services to be monitored.
            </td>
          </tr>
          
<tr class="a">
            
<td>services/service@name</td>
            
<td>String</td>
            
<td>[1..n]</td>
            
<td>
              The name of an individual service to be monitored.
            </td>
          </tr>
        </table>
      </section>
      <section>
<h3><a name="Role_Configuration"></a>Role Configuration</h3>
        
<div class="source">
<pre>
&lt;role
    name=&quot;org.apache.fulcrum.yaafi.interceptor.logging.LoggingInterceptorService&quot;
    shorthand=&quot;LoggingInterceptorService&quot;
    default-class=&quot;org.apache.fulcrum.yaafi.interceptor.logging.LoggingInterceptorServiceImpl&quot;
    logger=&quot;tracing&quot;
/&gt;
            </pre></div>
      </section>

      <section>
<h3><a name="Log4J_Configuration"></a>Log4J Configuration</h3>
        
<p>
          The following Log4J configuration defines a custom
          appender for the PerformanceInterceptorService. For
          the layout we just add a timestamp since we produce
          a CSV file to be analyzed with EXCEL or your tool
          of choice
        </p>
        
<div class="source">
<pre>
#
# Custom logfiles
#

log4j.category.yaafi.tracing = ERROR, tracing
log4j.additivity.yaafi.tracing = false

#
# Tracing Appender
#

log4j.appender.tracing = org.apache.log4j.RollingFileAppender
log4j.appender.tracing.file = ./temp/tracing.csv
log4j.appender.tracing.MaxFileSize=2000KB
log4j.appender.tracing.layout=org.apache.log4j.PatternLayout
log4j.appender.tracing.layout.conversionPattern=%d;%t;%m%n
log4j.appender.tracing.threshold=DEBUG
log4j.appender.tracing.append = true
        </pre></div>
      </section>
    </section>


    <section>
<h2><a name="Usage"></a>Usage</h2>
      
<p>
        Dump the method invocation of all services using ReflectionToStringBuilder
      </p>
      
<div class="source">
<pre>
        
&lt;LoggingInterceptorService&gt;
  &lt;isEnabled&gt;true&lt;/isEnabled&gt;
  &lt;maxArgLength&gt;2000&lt;/maxArgLength&gt;
  &lt;toStringBuilderClass&gt;org.apache.fulcrum.yaafi.interceptor.util.SmartToStringBuilderImpl&lt;/toStringBuilderClass&gt;
  &lt;monitorAllExceptions&gt;true&lt;/monitorAllExceptions&gt;
  &lt;services&gt;
    &lt;service name=&quot;*&quot;/&gt;
  &lt;/services&gt;
&lt;/LoggingInterceptorService&gt;
        
      </pre></div>
    </section>

  

      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        Copyright &#169;      2004&#x2013;2021<a href="https://www.apache.org/">The Apache Software Foundation</a>.
.      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
